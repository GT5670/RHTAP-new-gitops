= Adding secrets to GitLab for secure integration with external tools

If you select GitLab or GitHub actions as your CI provider when creating an application, you might notice that the pipeline run fails. This failure occurs because the pipeline cannot find the required secrets. Complete the following procedure to add the necessary secrets and resolve the pipeline failure.

.Prerequisites

* You must have the necessary permissions to create and manage GitHub and GitLab jobs and GitLab CI and GitHub Actions variables.

* You must have an image registry (for example, Quay.io) username and password for accessing and pull container images. 

* You must have the following information for specific tasks that you want the GitLab CI to perform:

** For ACS tasks:

*** ROX Central server endpoint and token

** For SBOM tasks:

*** Cosign signing keys password, private key, and public key

*** Trustification URL, client ID, secret, and supported CycloneDX version

.Procedure 

== Adding secrets using UI

. For GitLab:

.. Log in and navigate to your source repository.

.. Expand the *Setting* menu and select *CI/CD*.

.. In the Variables section, select *Expand*, and then select *Add variable*.

.. Under *Flags*, select the *Mask variable* checkbox.

.. In the *Key* field, enter *MY_GITLAB_TOKEN*.

.. In the *Value* field, enter the token associated with your GitLab account.

.. Repeat steps C through F to add the variables in step 3

. For GitHub:

.. Login and navigate to your GitHub repository.

.. Navigate to the Settings tab.

.. In the left navigation pane, select Secrets and variables, then select Actions.

.. Select new repository secret.

.. In the Name field, enter MY_GITHUB_TOKEN.

.. In the Value field, enter the token associated with your GitHub account.

.. Repeat steps C through F to add the variables in step 3

. Add the following varibales:


[cols="1,1", options="header"]
|===

| Variable | Description

2+| *Variables required for all pipeline runs*

| `QUAY_IO_CREDS_USR`
| Username for accessing Quay.io credentials.

| `QUAY_IO_CREDS_PSW`
| Password for accessing Quay.io credentials.

| `REKOR_HOST`
| URL of your Rekor server.

| `TUF_MIRROR`
| URL of your TUF service.

2+| *Variable required for ACS tasks* 

| `ROX_CENTRAL_ENDPOINT`
| Endpoint for the ROX Central server.

| `ROX_API_TOKEN`
| API token for accessing the ROX server.

2+| *Variables required for SBOM tasks*

| `COSIGN_SECRET_PASSWORD`
| Password for Cosign signing key.

| `COSIGN_SECRET_KEY`
| Private key for Cosign.

| `COSIGN_PUBLIC_KEY`
| Public key for Cosign.

| `TRUSTIFICATION_BOMBASTIC_API_URL`
| URL for Trustification Bombastic API used in SBOM generation.

| `TRUSTIFICATION_OIDC_ISSUER_URL`
| OIDC issuer URL used for authentication when interacting with the Trustification Bombastic API.

| `TRUSTIFICATION_OIDC_CLIENT_ID`
| Client ID for authenticating to the Trustification Bombastic API using OIDC.

| `TRUSTIFICATION_OIDC_CLIENT_SECRET`
| Client secret used alongside the client ID to authenticate to the Trustification Bombastic API.

| `TRUSTIFICATION_SUPPORTED_CYCLONEDX_VERSION`
| Specifies the CycloneDX SBOM version that is supported and generated by the system.

|===

. Rerun the last pipeline run.

.. Alternatively, switch to you application's source repository in GitLab, make a minor change, and commit it to trigger a new pipeline run.
